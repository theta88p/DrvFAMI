ca65 V2.19 - Git e5f4ca6
Main file   : nmi_main.s
Current file: nmi_main.s

000000r 1               
000000r 1               	.export		NMI_main
000000r 1               	.import		drv_main
000000r 1               
000000r 1               	.import		__cc
000000r 1               	.import		__ss
000000r 1               	.import		__mm
000000r 1               	.import		__hh
000000r 1               
000000r 1               
000000r 1               .segment	"LOWCODE"
000000r 1               ;===============================================================
000000r 1               ;			nmi_main(void);
000000r 1               ;---------------------------------------------------------------
000000r 1               ;	Summary :		NMI main Routine
000000r 1               ;	Arguments :		None
000000r 1               ;	Return :		None
000000r 1               ;	Modifies :		None
000000r 1               ;	Useage :		Please write this address to interrupt vector
000000r 1               ;---------------------------------------------------------------
000000r 1               ;	《メモ》
000000r 1               ;	・NMI割り込みは、PPU関連の操作を先にやる
000000r 1               ;	　PPUへのアクセスは、垂直同期帰還中にしかできないため。
000000r 1               ;	・キーの読み込みも、NMI割り込みで行う。
000000r 1               ;	　キー読み込み中に音源ドライバーが割り込むと、キー読み込みに失敗するため。
000000r 1               ;===============================================================
000000r 1               .proc	NMI_main
000000r 1               
000000r 1               ;---------------------------------------
000000r 1               ;register push
000000r 1               ;---------------------------------------
000000r 1  48           	pha
000001r 1  98           	tya
000002r 1  48           	pha
000003r 1  8A           	txa
000004r 1  48           	pha
000005r 1               
000005r 1               ;---------------------------------------
000005r 1               ; Call sound driver main routine
000005r 1               ;---------------------------------------
000005r 1               
000005r 1               	;---------------
000005r 1               	;サウンドドライバ呼出し
000005r 1               
000005r 1  20 rr rr     	jsr	drv_main
000008r 1               
000008r 1               ;---------------------------------------
000008r 1               ; Count-up
000008r 1               ;---------------------------------------
000008r 1               Count:
000008r 1               @cc:
000008r 1  EE rr rr     	inc	__cc
00000Br 1  AD rr rr     	lda	__cc
00000Er 1  C9 3C        	cmp	#60
000010r 1  D0 48        	bne	@exit
000012r 1  A9 00        	lda	#0
000014r 1  8D rr rr     	sta	__cc
000017r 1               
000017r 1               @ss:
000017r 1  AE rr rr     	ldx	__ss
00001Ar 1  E0 59        	cpx	#$59
00001Cr 1  F0 14        	beq	@ss_1
00001Er 1  E8           	inx
00001Fr 1  8E rr rr     	stx	__ss
000022r 1  8A           	txa
000023r 1  29 0F        	and	#$0F
000025r 1  C9 0A        	cmp	#$0A
000027r 1  D0 31        	bne	@exit
000029r 1  8A           	txa
00002Ar 1  18           	clc
00002Br 1  69 06        	adc	#6
00002Dr 1  8D rr rr     	sta	__ss
000030r 1  D0 28        	bne	@exit
000032r 1               @ss_1:
000032r 1  A9 00        	lda	#0
000034r 1  8D rr rr     	sta	__ss
000037r 1               
000037r 1               @mm:
000037r 1  AE rr rr     	ldx	__mm
00003Ar 1  E0 59        	cpx	#$59
00003Cr 1  F0 14        	beq	@mm_1
00003Er 1  E8           	inx
00003Fr 1  8E rr rr     	stx	__mm
000042r 1  8A           	txa
000043r 1  29 0F        	and	#$0F
000045r 1  C9 0A        	cmp	#$0A
000047r 1  D0 11        	bne	@exit
000049r 1  8A           	txa
00004Ar 1  18           	clc
00004Br 1  69 06        	adc	#6
00004Dr 1  8D rr rr     	sta	__mm
000050r 1  D0 08        	bne	@exit
000052r 1               @mm_1:
000052r 1  A9 00        	lda	#0
000054r 1  8D rr rr     	sta	__mm
000057r 1               
000057r 1               @hh:
000057r 1  EE rr rr     	inc	__hh
00005Ar 1               
00005Ar 1               @exit:
00005Ar 1               
00005Ar 1               ;---------------------------------------
00005Ar 1               ;register pop
00005Ar 1               ;---------------------------------------
00005Ar 1  68           	pla
00005Br 1  AA           	tax
00005Cr 1  68           	pla
00005Dr 1  A8           	tay
00005Er 1  68           	pla
00005Fr 1               
00005Fr 1  40           	rti
000060r 1               .endproc
000060r 1               
